<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><title>2048</title><script type="text/javascript">(function(n,m){var a=n||100;var j=m||1;var h=window;var l=h.document;var b=navigator.userAgent;var g=b.match(/Android[\S\s]+AppleWebkit\/(\d{3})/i);var d=b.match(/U3\/((\d+|\.){5,})/i);var e=d&&parseInt(d[1].split(".").join(""),10)>=80;var c=navigator.appVersion.match(/(iphone|ipad|ipod)/gi);var k=h.devicePixelRatio||1;if(!c&&!(g&&g[1]>534)&&!e){k=1}var f=1/k;var i=l.querySelector('meta[name="viewport"]');if(!i){i=l.createElement("meta");i.setAttribute("name","viewport");l.head.appendChild(i)}i.setAttribute("content","width=device-width,user-scalable=no,initial-scale="+f+",maximum-scale="+f+",minimum-scale="+f);l.documentElement.style.fontSize=a/2*k*j+"px"})();</script><style type="text/css">*{margin:0;padding:0;box-sizing:border-box}body{font-family:PingFang SC,Helvetica Neue,Hiragino Sans GB,Helvetica,Microsoft YaHei,Arial;font-size:.28rem;background-color:#F9F9F1;color:#776E65;overflow-x:hidden}#game{margin:0 auto}#game .info{font-size:.04em;font-weight:700;padding:1em;display:flex;display:-webkit-flex;justify-content:space-between}#game .info>*{text-align:center;padding:.3em .6em;background-color:#BBADA0;border-radius:.28em;color:#fff}#game .info.btn>*{padding:.6em 1em;background-color:#52B9CA}#game .info.btn>.restart{background-color:#FC682C}#game .info .tt{padding-bottom:.1rem;opacity:.6}#grid{width:100%;background:#BBADA0}#grid ul{display:block;font-size:0;width:100%}#grid ul li{list-style:none;text-align:center;font-size:80px;display:inline-table;padding:.04em;vertical-align:middle}#grid ul li span{font-size:.6em;display:table-cell;vertical-align:middle;background-color:#F05D3A;color:#fff;border-radius:.08em;text-decoration:none}#grid ul li.cell2 span{color:#776E65;background-color:#EDE3D9}#grid ul li.cell4 span{color:#776E65;background-color:#EDE2C6}#grid ul li.cell8 span{background-color:#F3AD76}#grid ul li.cell16 span{background-color:#F89164}#grid ul li.cell32 span{background-color:#F27D5F}#grid ul li.cell0 span{background-color:#CCC0B0;border:1px solid #EAE1D7}#game .menu{margin:.1em;font-size:.2em}.mask{width:100%;height:100%;background-color:rgba(0,0,0,.8);position:fixed;left:0;top:0;display:none}.mask .box{background-color:#F9F9F1;position:absolute;left:10%;right:10%;top:10%;bottom:10%;padding:1em;border-radius:1em}.mask .box h1{font-size:2.6em;text-align:center;padding:.4em;color:#6B8E0B}.mask .box .start,.mask .box li{text-align:center;font-size:1.4em;list-style:none;display:block;padding:.5em 0;border-radius:3em;cursor:pointer}.mask .box ul{padding:0 1em}.mask .box li.active{background-color:#01ABCE;color:#fff}.mask .box .start{background-color:#FC682C;color:#fff;border-radius:.2em;margin-top:2em}.mask.show{display:block}</style></head><body>	<div id="game">		<div class="info">			<div class="score">				<div class="tt">SCORE</div>				<span id="score">0</span>			</div>			<div class="max">				<div class="tt">BEST</div>				<span id="max">0</span>			</div>		</div>		<div id="grid"></div>		<div class="info btn">			<div class="toMenu" id="menuBtn">返回菜单</div>			<div class="restart" id="restartBtn">重新开始</div>		</div>	</div>	<div class="mask show" id="selectMask">		<div class="box">			<h1>2048</h1>			<ul>				<li class="typ active" data-range="4">4×4宫格</li>				<li class="typ" data-range="6">6×6宫格</li>				<li class="typ" data-range="8">8×8宫格</li>				<li class="typ" data-range="12">12×12宫格</li>			</ul>			<div class="start">开始游戏</div>		</div>	</div>	<script src="http://cdn.bootcss.com/hammer.js/2.0.8/hammer.min.js"></script>	<script type="text/javascript">function game2048(c){var a=this;this.opt={score:0,max:0,range:4,step:0,beforeArrange:null,arrange:null,gameOver:false,cellWidth:80,isSupportTouch:"ontouchend" in document?true:false};for(var d in c){if(c[d]!==undefined){this.opt[d]=c[d]}}if(!this.opt.arrange){this.initArrange()}this.$game=this.$("game");this.$score=this.$("score");this.$max=this.$("max");this.$grid=this.$("grid");this.setWidth(this.opt.range);var b="orientationchange" in window?"orientationchange":"resize";window.addEventListener(b,function(){a.setWidth(a.opt.range);a.render()},false);this.bindEvent();this.render()}game2048.prototype={$:function(a){return document.getElementById(a)},restart:function(a){a&&this.setWidth(a);this.initArrange(a);this.render()},setWidth:function(b){var c=document.documentElement.clientWidth;var a=document.documentElement.clientHeight;if(a/c<1.34){c=a/1.34;this.$game.style.width=c+"px"}this.opt.cellWidth=~~(c*0.98/b);this.$grid.style.padding=c*0.01+"px";this.$game.style.fontSize=c+"px"},arrMerge:function(a){var c=[];if(!a){return false}for(var b=0;b<a.length;b++){c=c.concat(a[b])}return c},isFull:function(){var a=this.opt.arrange;var b=this.arrMerge(a);return b.every(function(c){return c!==0})},getMax:function(){this.opt.max=this.arrMerge(this.opt.arrange).sort(function(d,c){return c-d})[0];if(this.opt.max===2048){alert("恭喜你达成2048成就！")}},gridCanotMove:function(a){return a.every(function(c){var b=false;c.sort(function(e,d){e===d?b=true:null;return false});return b===false})},canotMove:function(){var b=this.opt.arrange;var a=b&&this.transform(this.deepCopy(b));return b&&this.isFull()&&this.gridCanotMove(b)&&this.gridCanotMove(a)},numGenerator:function(c){var b=this.opt.range-1;var a=Math.round(Math.random()*b);var e=Math.round(Math.random()*b);var d=this.opt.step>50?(Math.random()>=0.8?4:2):2;if(c[a][e]===0){c[a][e]=d}else{this.numGenerator(c)}},initArrange:function(c){this.opt.step=0;this.opt.max=2;this.opt.score=0;this.opt.gameOver=false;var b=[];if(c){this.opt.range=c}var a=this.opt.range;for(var e=0;e<a;e++){var f=[];for(var d=0;d<a;d++){f.push(0)}b.push(f)}for(var e=0;e<this.opt.range/2;e++){this.numGenerator(b)}this.opt.beforeArrange=this.opt.arrange=b;console.log(this.opt.arrange.join("\n"))},deepCopy:function(d){var b=[],a=d.length;for(var c=0;c<a;c++){if(d[c] instanceof Array){b[c]=this.deepCopy(d[c])}else{b[c]=d[c]}}return b},transform:function(b){var f=0;var a=b.length;var e=this.deepCopy(b);for(var d=0;d<a;d++){for(var c=0;c<a;c++){e[c][d]=b[d][c]}}return e},moveCore:function(d){var f,c,b,e=false,a=d.length;for(f=0;f<a;f+=1){c=-1;for(b=f+1;b<a;b++){if(d[b]!==0){c=b;break}}if(c!==-1){if(d[f]===0){d[f]=d[c];d[c]=0;e=true;f-=1}else{if(d[f]===d[c]){d[f]=d[f]*2;this.opt.score+=d[f];d[c]=0;e=true}}}}return e},moveAfter:function(a){this.opt.beforeArrange=this.opt.arrange;this.opt.arrange=a;this.opt.step+=1;for(var b=0;b<this.opt.range/4;b++){this.numGenerator(a)}this.getMax();this.render();console.log(this.opt.arrange.join("\n"))},reverseMove:function(e,d){if(this.opt.gameOver){var b=confirm("游戏结束，是否重新开始？");b?this.restart():null;return}var j=this;var c=true;var g=this.deepCopy(this.opt.arrange);e?g=this.transform(g):null;for(var f=0;f<g.length;f++){var h,a;d?a=g[f].reverse():a=g[f];h=this.moveCore(a);d?a.reverse():null;if(h){c=false}}e?g=this.transform(g):null;if(!c){this.moveAfter(g)}else{console.log("未发生移动！");if(this.canotMove()){this.opt.gameOver=true}}},moveLeft:function(){this.reverseMove(false,false)},moveRight:function(){this.reverseMove(false,true)},moveUp:function(){this.reverseMove(true,false)},moveDown:function(){this.reverseMove(true,true)},bindEvent:function(){var a=this;document.addEventListener("keyup",function(f){var d=f.keyCode;switch(d){case 38:a.moveUp();break;case 40:a.moveDown();break;case 37:a.moveLeft();break;case 39:a.moveRight();break;default:break}},false);if(this.opt.isSupportTouch){var c=new Hammer.Manager(a.$("grid"));var b=new Hammer.Swipe();c.add(b);c.on("swipe",function(g){var f=g.deltaX;var d=g.deltaY;if(Math.abs(f)>Math.abs(d)){f>0?a.moveRight():a.moveLeft()}else{d>0?a.moveDown():a.moveUp()}})}},render:function(){var c=this.opt.arrange,b=this;this.$score.innerText=this.opt.score;this.$max.innerText=this.opt.max;var a=document.createDocumentFragment();c.forEach(function(f){var d=document.createElement("ul");var e=".6";f.forEach(function(h){var g=document.createElement("li"),i;if(h>9){e=".56";if(h>99){e=".46";if(h>999){e=".36";if(h>9999){e=".26";if(h>99999){e=".24"}}}}}g.innerHTML=h?'<span style="font-size: '+e+'em">'+h+"</span>":"<span></span>";g.className="cell"+h;g.style.width=g.style.height=g.style.fontSize=b.opt.cellWidth+"px";d.appendChild(g)});a.appendChild(d)});this.$grid.innerHTML="";this.$grid.appendChild(a)}};var GAME=new game2048();var gameType=4;var slectedType=document.querySelector(".typ.active");var selectMask=document.getElementById("selectMask");var menuBtn=document.getElementById("menuBtn");var restartBtn=document.getElementById("restartBtn");selectMask.addEventListener("click",function(b){var a=b.target;if(a.className=="typ"){slectedType.classList.remove("active");gameType=a.getAttribute("data-range")*1;a.classList.add("active");slectedType=a}else{if(a.className=="start"){gameType!==GAME.opt.range?GAME.restart(gameType):null;selectMask.style.display="none"}}},false);menuBtn.addEventListener("click",function(){selectMask.style.display=""},false);restartBtn.addEventListener("click",function(){GAME.restart()},false);</script></body></html>