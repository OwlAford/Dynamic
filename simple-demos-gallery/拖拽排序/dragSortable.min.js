function sortable(t,i){this.elemsName=t;this.options=i;this.init()}sortable.prototype={coord:function(){var t=this.container=document.querySelector(this.options.container);var i=this.allBox=$(t).find("li");var e=this.number=i.size();var o=this.options.col;var s=[];var n=this.areaWidth=t.offsetWidth;var a=this.cellWidth=this.areaWidth/o;var r=this.cellHeight=this.options.cellHeight||this.cellWidth;for(var h=0;h<e;h++){s.push({x:h%o*a,y:Math.floor(h/o)*r})}this.coordArr=s},init:function(){this.elems=$(this.elemsName);this.coord();var t=this;this.container.style.height=this.cellHeight*Math.ceil(this.number/this.options.col)+"px";this.containerOffsetLeft=this.container.offsetLeft;this.containerOffsetTop=this.container.offsetTop;function i(i,e){$(i).css({position:"absolute",left:t.coordArr[e].x+"px",top:t.coordArr[e].y+"px",width:t.cellWidth+"px",height:t.cellHeight+"px"})}this.elems.each(function(e){this.box=$(this).parent();this.box.poz=t.coordArr[e];i(this.box,e);i(this,e);$(this).attr("index",e).appendTo(t.container);!$(this).hasClass(t.options.excludeClassName)&&t.bindDrag(this)});t.initPressDelate()},getPos:function(t){var i={x:t.originalEvent.changedTouches[0].clientX-this.containerOffsetLeft,y:t.originalEvent.changedTouches[0].clientY-this.containerOffsetTop};return i},move:function(t){$(t).css({left:t.box.poz.x+"px",top:t.box.poz.y+"px"})},sortCheck:function(t){var i=$(t).siblings(this.elemsName);var e=this;i.each(function(){if(t.pointer.x>this.box.poz.x&&t.pointer.y>this.box.poz.y&&t.pointer.x<this.box.poz.x+e.cellWidth&&t.pointer.y<this.box.poz.y+e.cellHeight&&!$(this).hasClass(e.options.excludeClassName)){if(t.box.poz.y<this.box.poz.y){var i=this.box;var o=this;var s=t.box.index();var n=o.box.index();for(var a=n;a>s;a--){var r=$(e.elemsName+'[index="'+(a-1)+'"]')[0];o.box=r.box;$(o).attr("index",o.box.index());e.move(o);o=r}t.box=i;$(t).attr("index",i.index())}else if(t.box.poz.y>this.box.poz.y){var i=this.box;var o=this;var s=o.box.index();var n=t.box.index();for(var a=s;a<n;a++){var h=$(e.elemsName+'[index="'+(a+1)+'"]')[0];o.box=h.box;$(o).attr("index",o.box.index());e.move(o);o=h}t.box=i;$(t).attr("index",i.index())}else{var c=this.box;this.box=t.box;t.box=c;e.move(this);$(t).attr("index",t.box.index());$(this).attr("index",this.box.index())}}})},bindDrag:function(t){function i(t,i){this.x=t;this.y=i}function e(t,i){this.left=t;this.top=i}var o=new e;var s=new i;var n=false;var a=this;$(t).on("touchstart",function(i){var e=a.getPos(i);o.left=$(t).position().left;o.top=$(t).position().top;s.x=e.x;s.y=e.y;n=true});$(t).on("touchmove",function(e){var r=a.options.necessaryClassName;if(r&&!$(this).hasClass(r)){n=false;return}e.preventDefault();var h=a.getPos(e);var c=new i(h.x,h.y);if(!n)return;$(t).addClass("active").css({opacity:"0.8","z-index":999,"border-width":"1px 1px 0"});var x=c.x-s.x+o.left;var l=c.y-s.y+o.top;$(t).css({left:x,top:l});t.pointer=c;a.sortCheck(t)});$(t).on("touchend",function(){if(!n)return;n=false;a.move(t);$(t).removeClass("active").css({opacity:"","z-index":"","border-width":""})})},initPressDelate:function(){var t=this;var i=this.elems;var e=i.find(t.options.delater);var o=t.options.necessaryClassName;var s=t.options.excludeClassName;e.off("tap").on("tap",function(i){t.destroy();$(this).parents("li").remove();t.init();i.stopPropagation()});$(document).on("tap",function(){i.removeClass(o)});i.on("press",function(){var t=$(this);!t.hasClass(s)&&t.addClass(o)})},destroy:function(){var t=this;this.elems.each(function(i){$(this).off("touchstart touchmove touchend").removeAttr("style");curIndex=$(this).attr("index");$(t.allBox.eq(curIndex)).append(this)})}};